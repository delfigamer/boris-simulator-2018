(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     67206,       1600]
NotebookOptionsPosition[     64744,       1523]
NotebookOutlinePosition[     65947,       1558]
CellTagsIndexPosition[     65904,       1555]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Worker routines", "Section",
 CellChangeTimes->{{3.7285608275088573`*^9, 3.7285608383317575`*^9}, {
  3.728561137108688*^9, 3.7285611401501565`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"loadsource", "=", 
   RowBox[{"Function", "[", 
    RowBox[{
     RowBox[{"{", "sourcepath", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"source", "=", 
       RowBox[{"StringCases", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"sourcepath", ",", "\"\<Text\>\""}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"c", ":", 
             RowBox[{"(", 
              RowBox[{"LetterCharacter", "~~", 
               RowBox[{"WordCharacter", "..."}]}], ")"}]}], "\[Rule]", 
            RowBox[{"word", "[", "c", "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"c", ":", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                "DigitCharacter", "|", "\"\<-\>\"", "|", "\"\<+\>\""}], ")"}],
                "~~", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                 "WordCharacter", "|", "\"\<+\>\"", "|", "\"\<-\>\"", "|", 
                  "\"\<.\>\""}], ")"}], "..."}]}], ")"}]}], "\[RuleDelayed]", 
            
            RowBox[{"number", "[", "c", "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"c", ":", 
             RowBox[{"Except", "[", "WhitespaceCharacter", "]"}]}], "\[Rule]",
             "c"}]}], "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"token", "=", 
       RowBox[{"Function", "[", 
        RowBox[{
        "source", "\[LeftDoubleBracket]", "sourcepos", 
         "\[RightDoubleBracket]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"advance", "=", 
       RowBox[{"Function", "[", 
        RowBox[{"sourcepos", "+=", "1"}], "]"}]}]}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.7285459111801777`*^9, 3.7285460951104836`*^9}, {
   3.728546386092574*^9, 3.7285463904208956`*^9}, {3.7285464505017757`*^9, 
   3.7285464590646677`*^9}, {3.7285465476937313`*^9, 
   3.7285465516314116`*^9}, {3.7285465952271595`*^9, 
   3.7285466030556436`*^9}, {3.728546783110774*^9, 3.7285468214875317`*^9}, {
   3.7285468979129105`*^9, 3.728547085718395*^9}, {3.72854736745006*^9, 
   3.7285479733215837`*^9}, {3.7285480115733376`*^9, 
   3.7285480582629776`*^9}, {3.728548099624248*^9, 3.7285481919878592`*^9}, {
   3.728548222239246*^9, 3.7285482361305065`*^9}, {3.7285482909923973`*^9, 
   3.728548362526926*^9}, {3.728548493470428*^9, 3.728548555129505*^9}, {
   3.7285486866199074`*^9, 3.728548695573443*^9}, {3.728549119954585*^9, 
   3.728549136955363*^9}, {3.728549206440134*^9, 3.728549349852959*^9}, {
   3.7285495658628607`*^9, 3.728549580926051*^9}, {3.7285497086819077`*^9, 
   3.728549727448393*^9}, {3.728560844879376*^9, 3.728560845646506*^9}, {
   3.7285610594536047`*^9, 3.728561095621739*^9}, {3.7285635441730146`*^9, 
   3.728563578323184*^9}, {3.7285650509155545`*^9, 3.7285650593990164`*^9}, {
   3.7286271859102173`*^9, 3.7286272538770666`*^9}, {3.7286300265884266`*^9, 
   3.7286300684248877`*^9}, {3.7286301443654537`*^9, 
   3.7286302202208896`*^9}, {3.7286303191091657`*^9, 3.728630324691367*^9}, {
   3.7286303592671623`*^9, 3.728630364027155*^9}, {3.72863045597223*^9, 
   3.728630457834966*^9}, 3.7286315124853425`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"readvalue", "=", 
   RowBox[{"Function", "[", "\[IndentingNewLine]", 
    RowBox[{"Which", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"Head", "[", 
        RowBox[{"token", "[", "]"}], "]"}], "===", "number"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", "value", "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"value", "=", 
          RowBox[{
           RowBox[{"Interpreter", "[", "\"\<Number\>\"", "]"}], "[", 
           RowBox[{
            RowBox[{"token", "[", "]"}], "\[LeftDoubleBracket]", "1", 
            "\[RightDoubleBracket]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"advance", "[", "]"}], ";", "\[IndentingNewLine]", 
         "value"}]}], "]"}], ",", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Head", "[", 
        RowBox[{"token", "[", "]"}], "]"}], "===", "word"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", "name", "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"name", "=", 
          RowBox[{
           RowBox[{"token", "[", "]"}], "\[LeftDoubleBracket]", "1", 
           "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"advance", "[", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"token", "[", "]"}], "=!=", "\"\<(\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
           "Throw", "[", "\"\<expected ( after a generator name\>\"", "]"}]}],
           "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"advance", "[", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"token", "[", "]"}], "===", "\"\<)\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Block", "[", 
            RowBox[{
             RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"advance", "[", "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"generator", "[", 
               RowBox[{"name", ",", 
                RowBox[{"{", "}"}]}], "]"}]}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Block", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"args", "=", 
               RowBox[{"{", "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"While", "[", 
               RowBox[{"True", ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Head", "[", 
                    RowBox[{"token", "[", "]"}], "]"}], "=!=", "number"}], 
                   ",", "\[IndentingNewLine]", 
                   RowBox[{
                   "Throw", "[", 
                    "\"\<expected a number as the generator argument\>\"", 
                    "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
                 RowBox[{"AppendTo", "[", 
                  RowBox[{"args", ",", 
                   RowBox[{
                    RowBox[{"Interpreter", "[", "\"\<Number\>\"", "]"}], "[", 
                    
                    RowBox[{
                    RowBox[{"token", "[", "]"}], "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "]"}]}], "]"}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"advance", "[", "]"}], ";", "\[IndentingNewLine]", 
                 RowBox[{"Which", "[", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"token", "[", "]"}], "===", "\"\<)\>\""}], ",", 
                   RowBox[{
                    RowBox[{"advance", "[", "]"}], ";", 
                    RowBox[{"Break", "[", "]"}]}], ",", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"token", "[", "]"}], "===", "\"\<,\>\""}], ",", 
                   RowBox[{"advance", "[", "]"}], ",", "\[IndentingNewLine]", 
                   "True", ",", 
                   RowBox[{
                   "Throw", "[", 
                    "\"\<expected ) after a generator argument\>\"", "]"}]}], 
                  "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"generator", "[", 
               RowBox[{"name", ",", "args"}], "]"}]}]}], "]"}]}], "]"}]}]}], 
       "]"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"token", "[", "]"}], "===", "\"\<[\>\""}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"rows", "=", "0"}], ",", "\[IndentingNewLine]", 
          RowBox[{"cols", "=", "0"}], ",", "\[IndentingNewLine]", 
          RowBox[{"vrow", "=", 
           RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"value", "=", 
           RowBox[{"{", "}"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"advance", "[", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"While", "[", 
          RowBox[{"True", ",", "\[IndentingNewLine]", 
           RowBox[{"Which", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"Head", "[", 
               RowBox[{"token", "[", "]"}], "]"}], "===", "number"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"Block", "[", 
              RowBox[{
               RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"AppendTo", "[", 
                 RowBox[{"vrow", ",", 
                  RowBox[{
                   RowBox[{"Interpreter", "[", "\"\<Number\>\"", "]"}], "[", 
                   RowBox[{
                    RowBox[{"token", "[", "]"}], "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "]"}]}], "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"advance", "[", "]"}]}]}], "]"}], ",", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"token", "[", "]"}], "===", "\"\<;\>\""}], "||", 
              RowBox[{
               RowBox[{"token", "[", "]"}], "===", "\"\<]\>\""}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"Block", "[", 
              RowBox[{
               RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", "vrow", "]"}], "\[NotEqual]", "0"}],
                   ",", "\[IndentingNewLine]", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"rows", "\[Equal]", "0"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Block", "[", 
                    RowBox[{
                    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"rows", "=", "1"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"cols", "=", 
                    RowBox[{"Length", "[", "vrow", "]"}]}]}]}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Block", "[", 
                    RowBox[{
                    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "vrow", "]"}], "\[NotEqual]", 
                    "cols"}], ",", 
                    RowBox[{
                    "Throw", "[", "\"\<matrix rows are uneven\>\"", "]"}]}], 
                    "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"rows", "+=", "1"}]}]}], "]"}]}], "]"}]}], "]"}], 
                ";", "\[IndentingNewLine]", 
                RowBox[{"AppendTo", "[", 
                 RowBox[{"value", ",", "vrow"}], "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"token", "[", "]"}], "===", "\"\<]\>\""}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"advance", "[", "]"}], ";", 
                   RowBox[{"Break", "[", "]"}]}], ",", "\[IndentingNewLine]", 
                  
                  RowBox[{
                   RowBox[{"advance", "[", "]"}], ";", 
                   RowBox[{"vrow", "=", 
                    RowBox[{"{", "}"}]}]}]}], "]"}]}]}], "]"}], ",", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"token", "[", "]"}], "===", "\"\<,\>\""}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"advance", "[", "]"}], ",", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", "True", ",", "\[IndentingNewLine]", 
             RowBox[{
             "Throw", "[", "\"\<failed to parse a matrix element\>\"", 
              "]"}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
         "value"}]}], "]"}], ",", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", "True", ",", "\[IndentingNewLine]", 
      RowBox[{"Throw", "[", "\"\<failed to parse a value\>\"", "]"}]}], "]"}],
     "]"}]}], ";"}]], "Input",
 CellChangeTimes->CompressedData["
1:eJwd0E0ogwEcBvAlTmO2w0oZtnxctBAtkx0Ibe8cZjJ2MFmbsUQ+QiktZM1G
EpqaZEiNjJKUNdEyaRx8rWWpNcu07IAUxbzPe/j3OzzPc/nz1L1ybRKNRssi
DyZ7Iox1b6yKbQrnQ9VXNQF/hq8oLQyZHJ6x1I0wtXRIBafKPimfa3QaeO9t
18Ihc3gUBpedBjgnEE3DjN/DNarfEfdAPeFgbpBetPSzoUwvzoT+7wEuNNsS
hfBly1sEOfzJEnh02lYOF4KyKniS5myA0TyNEoofbrvgpvJdD7/Mf6uwaT7b
Tu3Y1w7YJz12wVnbsR8K7CsBWHyz+AorlfEYDOTalA5S/t4BZXyiZxBKIh8j
UGFK2d7GP5oJJxTWt+p2SN2e7k5o4Ircl9gxXedQcyfn+Uh3rTMF0LdPL4ZG
llEIJWPhWirPWaqDVkuUgINPBikc5yQUkH5U0QzfjOmPkAiFgvAfRaMPYQ==

  "]],

Cell[BoxData[
 RowBox[{
  RowBox[{"readinput", "=", 
   RowBox[{"Function", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", "target", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"input", "=", 
         RowBox[{"Association", "[", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"sourcepos", "=", "1"}], ";", "\[IndentingNewLine]", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"sourcepos", "\[LessEqual]", 
           RowBox[{"Length", "[", "source", "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Head", "[", 
               RowBox[{"token", "[", "]"}], "]"}], "=!=", "word"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
             "Throw", "[", "\"\<failed to parse a statement\>\"", "]"}]}], 
            "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"target", "=", 
            RowBox[{
             RowBox[{"token", "[", "]"}], "\[LeftDoubleBracket]", "1", 
             "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"advance", "[", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"Which", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"token", "[", "]"}], "===", "\"\<=\>\""}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"advance", "[", "]"}], ";", 
              RowBox[{
               RowBox[{"input", "[", "target", "]"}], "=", 
               RowBox[{"readvalue", "[", "]"}]}]}], ",", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", "True", ",", 
             "\[IndentingNewLine]", 
             RowBox[{
             "Throw", "[", "\"\<failed to parse a statement\>\"", "]"}]}], 
            "]"}]}]}], "]"}]}]}], "]"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->CompressedData["
1:eJwd0E0owwEYBvAlTmO2w0r5XD4uWiaSicOE9uEwk80OyBpjyecapbSQNRtJ
aGqSIbVpo6SVNdEyaRx8rWVcZplkB7SimP/zP7z9Ds/zXF6WYkDSlUShULKJ
g8neCG3T98ZjGsKFsD1eK4Q/o5ekJppYAk8ZimaYWqZthzPlX6TPdSolvPN1
dkGtMTwOQ6tOHVyoqJmFGb+HG2S/O+aFaqGNvkV43jrMhGI1PxMGvkfyoNGS
KIYvO74SmMWeLoWuk45KuBQS8+BxmrMJRguUcsi/v+mF2/IPNYwb/9Zhy2KO
ldwxr2xwSHTkhvOWowCssK4FIed6+RVWy2NvMJhvkdsI2XsHpLGpfg0URD7H
oNSQYrfjHzKhE3Ib21S7hB5vXw/U5dV4LrCju8+g8lbC8hM6zHNF0L9P5UA9
Q8+FgolwPZnnrjRAsykqhJonnQhOZiWkkOqqksF3ffoDNDkGH+E/Q60PAA==

  "]],

Cell[BoxData[
 RowBox[{
  RowBox[{"getinputnumber", "=", 
   RowBox[{"Function", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"varname", ",", "fullname"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", "v", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"v", "=", 
         RowBox[{"input", "[", "varname", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Which", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"NumberQ", "[", "v", "]"}], ",", "\[IndentingNewLine]", "v",
           ",", "\[IndentingNewLine]", "\[IndentingNewLine]", "True", ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Throw", "[", 
           RowBox[{
           "fullname", "<>", "\"\< (\>\"", "<>", "varname", "<>", 
            "\"\<) must be provided as a number\>\""}], "]"}]}], "]"}]}]}], 
      "]"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->CompressedData["
1:eJwd0E0owwEYBvAlTmO2w0oZtnxctEy0TBwmtA+HmYwdTLQZS4Q1SmkhazaS
EDXJkBoZJS1bRMskc/C1lnEZmZYd0Ipi/s//8PY7PM9zeTntvXJNEoVCySIO
JntfaGu+qJBpDudDVbxKAn8G/aRWmkwOTxntDTC1xKCCE6VfpM/VWjW887Vp
oMESHoahJacRzvArJ2HG78Eq2e+IeaFO4qCvE5439zOhTCfKhIHvATa02BKF
8HXTVwRZ3PFi6DppLYNzIZkQHqc562EkT62EovubLrih/NDBuOVvBTbOZtvJ
HfPKAfukbg+ctrkDkG9fDkLe9fwbrFDGojCYa1M6CLm7+6SxsR49FL98DkGF
OWVrC/9okjihoK5Fu0145O3uhEZ25dEFdnTPGVTfyjmXhDuLUwXwco/KgyaG
SQDFI+EaMs9ZqIWL1ogE6p+MUjjKSigg1VXeBN9N6Q/wMOB/hP9Iag+0
  "]],

Cell[BoxData[
 RowBox[{
  RowBox[{"getinputsignal", "=", 
   RowBox[{"Function", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"varname", ",", "fullname"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", "v", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"v", "=", 
         RowBox[{"input", "[", "varname", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Which", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListQ", "[", "v", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "v", "]"}], "\[Equal]", "1"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"sconst", "[", 
             RowBox[{
             "v", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
             "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Throw", "[", 
             RowBox[{
             "fullname", "<>", "\"\< (\>\"", "<>", "varname", "<>", 
              "\"\<) has invalid dimensions\>\""}], "]"}]}], "]"}], ",", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Head", "[", "v", "]"}], "===", "generator"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Block", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"name", "=", 
               RowBox[{
               "v", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
              ",", 
              RowBox[{"args", "=", 
               RowBox[{
               "v", "\[LeftDoubleBracket]", "2", 
                "\[RightDoubleBracket]"}]}]}], "}"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Switch", "[", 
             RowBox[{
             "name", ",", "\[IndentingNewLine]", "\"\<swhite\>\"", ",", 
              "\[IndentingNewLine]", 
              RowBox[{"Block", "[", 
               RowBox[{
                RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
                RowBox[{"swhite", "[", "args", "]"}]}], "]"}], ",", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", "_", ",", 
              "\[IndentingNewLine]", 
              RowBox[{"Throw", "[", 
               RowBox[{
               "fullname", "<>", "\"\< (\>\"", "<>", "varname", "<>", 
                "\"\<) is given an invalid generator\>\""}], "]"}]}], "]"}]}],
            "]"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", "True", 
          ",", "\[IndentingNewLine]", 
          RowBox[{"Throw", "[", 
           RowBox[{
           "fullname", "<>", "\"\< (\>\"", "<>", "varname", "<>", 
            "\"\<) must be provided as a signal\>\""}], "]"}]}], "]"}]}]}], 
      "]"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->CompressedData["
1:eJwd0E0owwEYBvAlTmO2w0oZtnxctEwkkx0mtA+HmWx2MFmbsURYo5QWsmYj
CVGTDKlNRklqi2iZNA6+1rJ2GZmWHZCimP/zP7z9Ds/zXF6Opl+uS6NQKHnE
wXT/M20jkBAyrbFiqP6qk8Cf4StSO00mh2cMTQvMrDCp4VTlJ+lTvV4L7wOd
OmiyxUZhZMVjhnNVgmmY83u4Tva7kn5okLjom4QXbYNMKDOIcmHoe4gNbY5U
KXzZDpRBFneyHB6ddlTDhYhMCE+yPM0wXqRVQdHDbQ/cUr0b4Jftbw22zuc7
yR3z2gUHpF4fnHV4Q7DKuRqGvJvFV1irSiZguNChchFy9w5IkxN9Rih+/hiB
CmuG241/KCUeyG9q1+8QHvt7u6GZLTi+xI7uO4faOzknSLi7PFMCg/tUHrQw
LHwoHos1kHnBUiNctscl0Bg1S+E4K6WA1KMaJXyzZD9Crlsfhf9Abw6W
  "]],

Cell[BoxData[
 RowBox[{
  RowBox[{"getinputmatrix", "=", 
   RowBox[{"Function", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"varname", ",", "fullname", ",", "rows", ",", "cols"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", "v", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"v", "=", 
         RowBox[{"input", "[", "varname", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Which", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListQ", "[", "v", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "v", "]"}], "\[Equal]", "rows"}], "&&", 
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{
               "v", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
               "]"}], "\[Equal]", "cols"}]}], ",", "\[IndentingNewLine]", "v",
             ",", "\[IndentingNewLine]", 
            RowBox[{"Throw", "[", 
             RowBox[{
             "fullname", "<>", "\"\< (\>\"", "<>", "varname", "<>", 
              "\"\<) has invalid dimensions\>\""}], "]"}]}], "]"}], ",", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Head", "[", "v", "]"}], "===", "generator"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Block", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"name", "=", 
               RowBox[{
               "v", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
              ",", 
              RowBox[{"args", "=", 
               RowBox[{
               "v", "\[LeftDoubleBracket]", "2", 
                "\[RightDoubleBracket]"}]}]}], "}"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Switch", "[", 
             RowBox[{
             "name", ",", "\[IndentingNewLine]", "\"\<mnull\>\"", ",", 
              "\[IndentingNewLine]", 
              RowBox[{"Block", "[", 
               RowBox[{
                RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Length", "[", "args", "]"}], "\[NotEqual]", 
                    "0"}], ",", "\[IndentingNewLine]", 
                   RowBox[{
                   "Throw", "[", 
                    "\"\<mnull() generator expects no arguments\>\"", "]"}]}],
                   "]"}], ";", "\[IndentingNewLine]", 
                 RowBox[{"Table", "[", 
                  RowBox[{"0", ",", "rows", ",", "cols"}], "]"}]}]}], "]"}], 
              ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
              "\"\<muniform\>\"", ",", "\[IndentingNewLine]", 
              RowBox[{"Block", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"a", ",", "b"}], "}"}], ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Switch", "[", 
                  RowBox[{
                   RowBox[{"Length", "[", "args", "]"}], ",", 
                   "\[IndentingNewLine]", "0", ",", 
                   RowBox[{
                    RowBox[{"a", "=", "0"}], ";", 
                    RowBox[{"b", "=", "1"}]}], ",", "\[IndentingNewLine]", 
                   "1", ",", 
                   RowBox[{
                    RowBox[{"a", "=", "0"}], ";", 
                    RowBox[{"b", "=", 
                    RowBox[{
                    "args", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}]}]}], ",", "\[IndentingNewLine]",
                    "2", ",", 
                   RowBox[{
                    RowBox[{"a", "=", 
                    RowBox[{
                    "args", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}]}], ";", 
                    RowBox[{"b", "=", 
                    RowBox[{
                    "args", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}]}]}], ",", "\[IndentingNewLine]",
                    "_", ",", 
                   RowBox[{
                   "Throw", "[", 
                    "\"\<muniform(...) generator expects up to 2 \
arguments\>\"", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
                 RowBox[{"RandomReal", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"a", ",", "b"}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"rows", ",", "cols"}], "}"}]}], "]"}]}]}], "]"}], 
              ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
              "\"\<mnormal\>\"", ",", "\[IndentingNewLine]", 
              RowBox[{"Block", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"mean", ",", "dev"}], "}"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Switch", "[", 
                  RowBox[{
                   RowBox[{"Length", "[", "args", "]"}], ",", 
                   "\[IndentingNewLine]", "0", ",", 
                   RowBox[{
                    RowBox[{"mean", "=", "0"}], ";", 
                    RowBox[{"dev", "=", "1"}]}], ",", "\[IndentingNewLine]", 
                   "1", ",", 
                   RowBox[{
                    RowBox[{"mean", "=", "0"}], ";", 
                    RowBox[{"dev", "=", 
                    RowBox[{
                    "args", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}]}]}], ",", "\[IndentingNewLine]",
                    "2", ",", 
                   RowBox[{
                    RowBox[{"mean", "=", 
                    RowBox[{
                    "args", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}]}], ";", 
                    RowBox[{"dev", "=", 
                    RowBox[{
                    "args", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}]}]}], ",", "\[IndentingNewLine]",
                    "_", ",", 
                   RowBox[{
                   "Throw", "[", 
                    "\"\<mnormal(...) generator expects up to 2 \
arguments\>\"", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
                 RowBox[{"RandomVariate", "[", 
                  RowBox[{
                   RowBox[{"NormalDistribution", "[", 
                    RowBox[{"mean", ",", "dev"}], "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"rows", ",", "cols"}], "}"}]}], "]"}]}]}], "]"}], 
              ",", "\[IndentingNewLine]", "\[IndentingNewLine]", "_", ",", 
              "\[IndentingNewLine]", 
              RowBox[{"Throw", "[", 
               RowBox[{
               "fullname", "<>", "\"\< (\>\"", "<>", "varname", "<>", 
                "\"\<) is given an invalid generator\>\""}], "]"}]}], "]"}]}],
            "]"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", "True", 
          ",", "\[IndentingNewLine]", 
          RowBox[{"Throw", "[", 
           RowBox[{
           "fullname", "<>", "\"\< (\>\"", "<>", "varname", "<>", 
            "\"\<) must be provided as a matrix\>\""}], "]"}]}], "]"}]}]}], 
      "]"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->CompressedData["
1:eJwd0EsowwEcB/AlTmO2w0qZx/K4aJlomewwoT0cZjJ2QNYeLBEWSmmxrNlI
QlOTDKlNRkmrrYmWSTh4rWVxGI2WHZCiPP7f/+HX5/D9fi8/tqpPrkmhUCg5
xMHU4BNtLZQQMi2xItj+WSOB38PnpDaaTA6PGKommF4+1A4nKz5IH2t1angT
6tTAIWtsFEaXPEY4yxNMwayf/VWyr00GoV7ioq8TnrQOMKFML8qG4a/BfGh1
/JXA+GaoFLI4pjLoPeyohPNRmRAeZHga4XOhWglFt1fdcEP5poef1t8V2DyX
6yR3zAsX7Jf6/HDG4QtDnnM5ArmXCy+wWplMwEiBQ+ki5OzskSYneg1Q/PQ+
AhWWNLcb/2iReCC/oU23RRgI9nRBY74gcIod3X8M1ddy9hnhtn26GJ7tUrnQ
zDDzoXgsVkfmeYv10G57lkDDvVEKx1l/Ckj1VrXAV3PmHTRp4w/wH0RJDyk=

  "]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", 
   RowBox[{"signaldim", ",", "signalvalue"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"signaldim", "[", "s_", "]"}], ":=", 
   RowBox[{"Length", "[", 
    RowBox[{"s", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"signalvalue", "[", 
    RowBox[{"s_sconst", ",", "time_"}], "]"}], ":=", 
   RowBox[{"s", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"signalvalue", "[", 
    RowBox[{"s_swhite", ",", "time_"}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"s", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
    RowBox[{"RandomVariate", "[", 
     RowBox[{
      RowBox[{"NormalDistribution", "[", "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"Length", "[", 
        RowBox[{"s", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
        "]"}], "}"}]}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"signalcovariance", "[", "s_sconst", "]"}], ":=", 
   RowBox[{"Table", "[", 
    RowBox[{"0", ",", 
     RowBox[{"Length", "[", 
      RowBox[{"s", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
      "]"}], ",", 
     RowBox[{"Length", "[", 
      RowBox[{"s", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
      "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"signalcovariance", "[", "s_swhite", "]"}], ":=", 
   RowBox[{"DiagonalMatrix", "[", 
    RowBox[{"s", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"signalform", "[", "s_sconst", "]"}], ":=", 
   RowBox[{"MatrixForm", "[", 
    RowBox[{"s", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"signalform", "[", "s_swhite", "]"}], ":=", 
   RowBox[{"MatrixForm", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"NormalDistribution", "[", 
       RowBox[{"0", ",", "#"}], "]"}], "&"}], "/@", 
     RowBox[{"s", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"loadsystem", "=", 
   RowBox[{"Function", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"controlsignal", "=", 
       RowBox[{"getinputsignal", "[", 
        RowBox[{"\"\<U\>\"", ",", "\"\<control input\>\""}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"noisesignal", "=", 
       RowBox[{"getinputsignal", "[", 
        RowBox[{"\"\<N\>\"", ",", "\"\<noise input\>\""}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"initstate", "=", 
       RowBox[{"signalvalue", "[", 
        RowBox[{
         RowBox[{"getinputsignal", "[", 
          RowBox[{"\"\<X\>\"", ",", "\"\<initial state\>\""}], "]"}], ",", 
         "0"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"output", "=", 
       RowBox[{"signalvalue", "[", 
        RowBox[{
         RowBox[{"getinputsignal", "[", 
          RowBox[{"\"\<Y\>\"", ",", "\"\<initial output\>\""}], "]"}], ",", 
         "0"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"outputcount", "=", 
       RowBox[{"Length", "[", "output", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"stepcount", "=", 
       RowBox[{"getinputnumber", "[", 
        RowBox[{"\"\<T\>\"", ",", "\"\<simulation step count\>\""}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ssmat", "=", 
       RowBox[{"getinputmatrix", "[", 
        RowBox[{
        "\"\<A\>\"", ",", "\"\<state-to-state matrix\>\"", ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Length", "[", "initstate", "]"}], ",", 
         RowBox[{"Length", "[", "initstate", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"simat", "=", 
       RowBox[{"getinputmatrix", "[", 
        RowBox[{
        "\"\<B\>\"", ",", "\"\<control-to-state matrix\>\"", ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Length", "[", "initstate", "]"}], ",", 
         RowBox[{"signaldim", "[", "controlsignal", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"snmat", "=", 
       RowBox[{"getinputmatrix", "[", 
        RowBox[{
        "\"\<E\>\"", ",", "\"\<noise-to-state matrix\>\"", ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Length", "[", "initstate", "]"}], ",", 
         RowBox[{"signaldim", "[", "noisesignal", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"osmat", "=", 
       RowBox[{"getinputmatrix", "[", 
        RowBox[{
        "\"\<C\>\"", ",", "\"\<state-to-output matrix\>\"", ",", 
         "\[IndentingNewLine]", "outputcount", ",", 
         RowBox[{"Length", "[", "initstate", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"oimat", "=", 
       RowBox[{"getinputmatrix", "[", 
        RowBox[{
        "\"\<D\>\"", ",", "\"\<control-to-output matrix\>\"", ",", 
         "\[IndentingNewLine]", "outputcount", ",", 
         RowBox[{"signaldim", "[", "controlsignal", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"onmat", "=", 
       RowBox[{"getinputmatrix", "[", 
        RowBox[{
        "\"\<F\>\"", ",", "\"\<noise-to-output matrix\>\"", ",", 
         "\[IndentingNewLine]", "outputcount", ",", 
         RowBox[{"signaldim", "[", "noisesignal", "]"}]}], "]"}]}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"extdot", "=", 
   RowBox[{"Function", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"a", ",", "b"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "a", "]"}], "\[NotEqual]", "0"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"a", ".", "b"}], ",", "\[IndentingNewLine]", 
       RowBox[{"{", "}"}]}], "]"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->CompressedData["
1:eJwd0FsoQwEcBvAlSs1tD6dWFpbLixaihexhQoyHmZgpkzUbS4Q1Smm5LYYk
NDXJLXVcRqTVRLRM2jy4JouH0YbswWVFMec7D/9+D9/3vfy5ilZJQwiDwYin
Doban6IWHa9CYsiTDOWBfBH86XTRjkSJJfCIpaiAEZk6ORzM+qR9LFAr4ZWj
vgHqjJ5u6J6x6OE4XzAM2b+783Rf5bdDjYiMWaI8qW4noFhTHAtvvjsSoNEc
TIXeFUca5PD6M6D1sC4bTrrFQngQaSmHviSlDBZfXzTBZdm7BgaMf3OwciJu
gd4RZyRsK7XtwTGz7QbyF2ZvYfr51DPMk/lf4W2iWUZS8jZ3aP19LVpY8vTR
BauGwlZX8Q+pyAJzymrVa5T79uZGqE8Q7J9iF7N3DJWXEq6TcsM0mgKdW8x0
aGAZcmBJj6eQzuOni6BpxCeC2nt9KezlBKsg05orhW+G6DvYr/I+QPKFHe6i
jBvYZkI1Zz0a6r5qCPgPQ5UgWQ==
  "]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Main logic", "Section",
 CellChangeTimes->{{3.728561049153473*^9, 3.728561052497386*^9}}],

Cell[CellGroupData[{

Cell["Input reading", "Subsection",
 CellChangeTimes->{{3.7285608828701887`*^9, 3.728560888458398*^9}, {
  3.728629577669925*^9, 3.728629580504089*^9}}],

Cell[BoxData[
 RowBox[{"Catch", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
   "loadsource", "[", "\"\<D:\\\\mist\\\\boris\\\\input.txt\>\"", "]"}], ";", 
   "\[IndentingNewLine]", 
   RowBox[{"readinput", "[", "]"}], ";", "\[IndentingNewLine]", 
   RowBox[{"loadsystem", "[", "]"}], ";", "\[IndentingNewLine]", 
   RowBox[{"Print", "[", 
    RowBox[{"\"\<X=\>\"", ",", 
     RowBox[{"initstate", "//", "MatrixForm"}]}], "]"}], ";", 
   "\[IndentingNewLine]", 
   RowBox[{"Print", "[", 
    RowBox[{"\"\<U=\>\"", ",", 
     RowBox[{"controlsignal", "//", "signalform"}]}], "]"}], ";", 
   "\[IndentingNewLine]", 
   RowBox[{"Print", "[", 
    RowBox[{"\"\<N=\>\"", ",", 
     RowBox[{"noisesignal", "//", "signalform"}]}], "]"}], ";", 
   "\[IndentingNewLine]", 
   RowBox[{"Print", "[", 
    RowBox[{"\"\<Y=\>\"", ",", 
     RowBox[{"output", "//", "MatrixForm"}]}], "]"}], ";", 
   "\[IndentingNewLine]", 
   RowBox[{"Print", "[", 
    RowBox[{"\"\<A=\>\"", ",", 
     RowBox[{"ssmat", "//", "MatrixForm"}]}], "]"}], ";", 
   "\[IndentingNewLine]", 
   RowBox[{"Print", "[", 
    RowBox[{"\"\<B=\>\"", ",", 
     RowBox[{"simat", "//", "MatrixForm"}]}], "]"}], ";", 
   "\[IndentingNewLine]", 
   RowBox[{"Print", "[", 
    RowBox[{"\"\<E=\>\"", ",", 
     RowBox[{"snmat", "//", "MatrixForm"}]}], "]"}], ";", 
   "\[IndentingNewLine]", 
   RowBox[{"Print", "[", 
    RowBox[{"\"\<C=\>\"", ",", 
     RowBox[{"osmat", "//", "MatrixForm"}]}], "]"}], ";", 
   "\[IndentingNewLine]", 
   RowBox[{"Print", "[", 
    RowBox[{"\"\<D=\>\"", ",", 
     RowBox[{"oimat", "//", "MatrixForm"}]}], "]"}], ";", 
   "\[IndentingNewLine]", 
   RowBox[{"Print", "[", 
    RowBox[{"\"\<F=\>\"", ",", 
     RowBox[{"onmat", "//", "MatrixForm"}]}], "]"}], ";"}], "]"}]], "Input",
 CellChangeTimes->{
  3.728561080514545*^9, {3.728631733027339*^9, 3.7286318671063137`*^9}, {
   3.7286320028747673`*^9, 3.728632032431188*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["System simulation", "Subsection",
 CellChangeTimes->{{3.728560898605304*^9, 3.7285609029657097`*^9}, {
  3.728562597847156*^9, 3.728562598843618*^9}, {3.728629568602605*^9, 
  3.728629571193411*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"history", "=", 
   RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"state", "=", "initstate"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"control", ",", "noise"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Do", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"control", "=", 
        RowBox[{"signalvalue", "[", 
         RowBox[{"controlsignal", ",", "0"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"noise", "=", 
        RowBox[{"signalvalue", "[", 
         RowBox[{"noisesignal", ",", "0"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"output", "=", 
        RowBox[{
         RowBox[{"extdot", "[", 
          RowBox[{"osmat", ",", "state"}], "]"}], "+", 
         RowBox[{"extdot", "[", 
          RowBox[{"oimat", ",", "control"}], "]"}], "+", 
         RowBox[{"extdot", "[", 
          RowBox[{"onmat", ",", "noise"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"state", "=", 
        RowBox[{
         RowBox[{"extdot", "[", 
          RowBox[{"ssmat", ",", "state"}], "]"}], "+", 
         RowBox[{"extdot", "[", 
          RowBox[{"simat", ",", "control"}], "]"}], "+", 
         RowBox[{"extdot", "[", 
          RowBox[{"snmat", ",", "noise"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"AppendTo", "[", 
        RowBox[{"history", ",", 
         RowBox[{"Join", "[", 
          RowBox[{"output", ",", "state"}], "]"}]}], "]"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"step", ",", "1", ",", "stepcount"}], "}"}]}], "]"}]}], "]"}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.728559205020278*^9, 3.728559331426982*^9}, {
   3.728559409071046*^9, 3.728559477158072*^9}, {3.7285595410709653`*^9, 
   3.728559614052182*^9}, {3.72855972155311*^9, 3.728559724329188*^9}, {
   3.728559760527367*^9, 3.7285597954857235`*^9}, 3.7285606317062073`*^9, 
   3.728560771528617*^9, {3.7285639761356077`*^9, 3.7285639795676484`*^9}, {
   3.7285650371933947`*^9, 3.728565046188609*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Output and state response graph", "Subsection",
 CellChangeTimes->{{3.728560920775877*^9, 3.7285609294676437`*^9}}],

Cell[BoxData[
 RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Transpose", "[", "history", "]"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
   RowBox[{"PlotLegends", "\[Rule]", "Automatic"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"PlotRange", "\[Rule]", "Full"}], ",", "\[IndentingNewLine]", 
   RowBox[{"ImageSize", "\[Rule]", "600"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.7285597562971516`*^9, 3.728559757060273*^9}, {
   3.7285598044659166`*^9, 3.728559870747289*^9}, {3.7285606743348308`*^9, 
   3.72856067538237*^9}, {3.728560907897956*^9, 3.7285609102113543`*^9}, {
   3.728563699092605*^9, 3.7285637052646723`*^9}, 3.728563840301053*^9, 
   3.7286245613393097`*^9, {3.728630512923897*^9, 3.728630516279827*^9}, {
   3.728631178839186*^9, 3.728631204340649*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Stability analysis", "Subsection",
 CellChangeTimes->{{3.7285611678127937`*^9, 3.7285611723114033`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"poles", "=", 
   RowBox[{"Eigenvalues", "[", "ssmat", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", 
   RowBox[{"Style", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Which", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"MissingQ", "[", 
         RowBox[{"SelectFirst", "[", 
          RowBox[{"poles", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"Abs", "[", "#", "]"}], ">", "1"}], "&"}]}], "]"}], 
         "]"}]}], ",", "\[IndentingNewLine]", 
       "\"\<\:0421\:0438\:0441\:0442\:0435\:043c\:0430 \:043d\:0435\:0443\
\:0441\:0442\:043e\:0439\:0447\:0438\:0432\:0430\>\"", ",", 
       "\[IndentingNewLine]", 
       RowBox[{"!", 
        RowBox[{"MissingQ", "[", 
         RowBox[{"SelectFirst", "[", 
          RowBox[{"poles", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"Abs", "[", "#", "]"}], "\[Equal]", "1"}], "&"}]}], 
          "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
       "\"\<\:0421\:0438\:0441\:0442\:0435\:043c\:0430 \:043d\:0430 \:0433\
\:0440\:0430\:043d\:0438\:0446\:0435 \:0443\:0441\:0442\:043e\:0439\:0447\
\:0438\:0432\:043e\:0441\:0442\:0438\>\"", ",", "\[IndentingNewLine]", "True",
        ",", "\[IndentingNewLine]", 
       "\"\<\:0421\:0438\:0441\:0442\:0435\:043c\:0430 \:0443\:0441\:0442\
\:043e\:0439\:0447\:0438\:0432\:0430\>\""}], "]"}], ",", 
     "\[IndentingNewLine]", "\"\<Text\>\"", ",", "Bold"}], "]"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"ReIm", "[", "poles", "]"}], ",", "\[IndentingNewLine]", 
   RowBox[{"PlotMarkers", "\[Rule]", 
    RowBox[{"Style", "[", 
     RowBox[{"\"\<+\>\"", ",", 
      RowBox[{"FontSize", "\[Rule]", "32"}]}], "]"}]}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Epilog", "\[Rule]", 
    RowBox[{"Circle", "[", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0"}], "}"}], "]"}]}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.728561176569661*^9, 3.7285612169670057`*^9}, {
  3.7285612690264864`*^9, 3.728561455930064*^9}, {3.7285615110430307`*^9, 
  3.7285616469717216`*^9}, {3.7285616786011877`*^9, 3.7285616963712935`*^9}, {
  3.728561738964867*^9, 3.7285619358090487`*^9}, {3.728562049432973*^9, 
  3.728562049478039*^9}, {3.728562574112285*^9, 3.728562575101741*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Step response charachteristics", "Subsection",
 CellChangeTimes->{{3.7285627771655893`*^9, 3.7285627862198906`*^9}}],

Cell[BoxData[
 RowBox[{"Block", "[", 
  RowBox[{
   RowBox[{"{", "staticmat", "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"staticmat", "=", 
     RowBox[{
      RowBox[{"osmat", ".", 
       RowBox[{"Inverse", "[", 
        RowBox[{
         RowBox[{"IdentityMatrix", "[", 
          RowBox[{"Length", "[", "state", "]"}], "]"}], "-", "ssmat"}], "]"}],
        ".", "simat"}], "+", "oimat"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"Do", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "control", ",", "target", ",", "state", ",", "output", ",", 
          "\[IndentingNewLine]", 
          RowBox[{"sthistory", "=", 
           RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"minout", "=", 
           RowBox[{"Table", "[", 
            RowBox[{"0.0", ",", "outputcount"}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"maxout", "=", 
           RowBox[{"Table", "[", 
            RowBox[{"0.0", ",", "outputcount"}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"settime", "=", 
           RowBox[{"Table", "[", 
            RowBox[{"0", ",", "outputcount"}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"time", "=", "1"}], ",", "\[IndentingNewLine]", 
          RowBox[{"stoptime", "=", "10"}]}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"control", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"i", "\[Equal]", "index"}], ",", "1", ",", "0"}], "]"}],
             ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", 
              RowBox[{"signaldim", "[", "controlsignal", "]"}]}], "}"}]}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"target", "=", 
          RowBox[{"staticmat", ".", "control"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"state", "=", 
          RowBox[{"Table", "[", 
           RowBox[{"0", ",", 
            RowBox[{"Length", "[", "initstate", "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"While", "[", 
          RowBox[{
           RowBox[{"time", "\[LessEqual]", "stoptime"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"output", "=", 
             RowBox[{
              RowBox[{"extdot", "[", 
               RowBox[{"osmat", ",", "state"}], "]"}], "+", 
              RowBox[{"extdot", "[", 
               RowBox[{"oimat", ",", "control"}], "]"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"sthistory", ",", "output"}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Do", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Max", "[", 
                  RowBox[{"Abs", "[", 
                   RowBox[{
                    RowBox[{
                    "output", "\[LeftDoubleBracket]", "i", 
                    "\[RightDoubleBracket]"}], "-", 
                    RowBox[{
                    "target", "\[LeftDoubleBracket]", "i", 
                    "\[RightDoubleBracket]"}]}], "]"}], "]"}], ">", "0.05"}], 
                ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                  "settime", "\[LeftDoubleBracket]", "i", 
                   "\[RightDoubleBracket]"}], "=", "time"}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"2", "time"}], ">", "stoptime"}], ",", 
                   "\[IndentingNewLine]", 
                   RowBox[{"stoptime", "=", 
                    RowBox[{"2", "time"}]}]}], "]"}]}]}], "]"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"i", ",", 
                RowBox[{"Length", "[", "output", "]"}]}], "}"}]}], "]"}], ";",
             "\[IndentingNewLine]", 
            RowBox[{"minout", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"Min", "[", 
                RowBox[{
                 RowBox[{
                 "minout", "\[LeftDoubleBracket]", "i", 
                  "\[RightDoubleBracket]"}], ",", 
                 RowBox[{
                 "output", "\[LeftDoubleBracket]", "i", 
                  "\[RightDoubleBracket]"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", 
                 RowBox[{"Length", "[", "output", "]"}]}], "}"}]}], "]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"maxout", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"Max", "[", 
                RowBox[{
                 RowBox[{
                 "maxout", "\[LeftDoubleBracket]", "i", 
                  "\[RightDoubleBracket]"}], ",", 
                 RowBox[{
                 "output", "\[LeftDoubleBracket]", "i", 
                  "\[RightDoubleBracket]"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", 
                 RowBox[{"Length", "[", "output", "]"}]}], "}"}]}], "]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"state", "=", 
             RowBox[{
              RowBox[{"extdot", "[", 
               RowBox[{"ssmat", ",", "state"}], "]"}], "+", 
              RowBox[{"extdot", "[", 
               RowBox[{"simat", ",", "control"}], "]"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"time", "+=", "1"}]}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"Style", "[", 
           RowBox[{
            RowBox[{
            "\"\<\:041f\:0435\:0440\:0435\:0445\:043e\:0434\:043d\:044b\:0439 \
\:043f\:0440\:043e\:0446\:0435\:0441\:0441 \:0434\:043b\:044f \:0432\:0445\
\:043e\:0434\:0430 \>\"", "<>", 
             RowBox[{"ToString", "[", "index", "]"}]}], ",", "\"\<Text\>\"", 
            ",", "Bold"}], "]"}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Print", "[", 
             RowBox[{
              RowBox[{"Spacer", "[", "20", "]"}], ",", 
              RowBox[{"Style", "[", 
               RowBox[{
                RowBox[{
                "\"\<\:041f\:0440\:043e\:0446\:0435\:0441\:0441 \>\"", "<>", 
                 RowBox[{"ToString", "[", "index", "]"}], "<>", 
                 "\"\< \[Rule] \>\"", "<>", 
                 RowBox[{"ToString", "[", "i", "]"}]}], ",", "\"\<Text\>\"", 
                ",", "Bold"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"Print", "[", 
             RowBox[{
              RowBox[{"Spacer", "[", "40", "]"}], ",", 
              RowBox[{"Style", "[", 
               RowBox[{
               "\"\<\:0423\:0441\:0442\:043e\:044f\:0432\:0448\:0435\:0435\
\:0441\:044f \:0437\:043d\:0430\:0447\:0435\:043d\:0438\:0435: \>\"", ",", 
                "\"\<Text\>\"", ",", "Bold"}], "]"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
              "target", "\[LeftDoubleBracket]", "i", 
               "\[RightDoubleBracket]"}]}], "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"Print", "[", 
             RowBox[{
              RowBox[{"Spacer", "[", "40", "]"}], ",", 
              RowBox[{"Style", "[", 
               RowBox[{
               "\"\<\:0412\:0440\:0435\:043c\:044f \:043f\:0435\:0440\:0435\
\:0445\:043e\:0434\:043d\:043e\:0433\:043e \:043f\:0440\:043e\:0446\:0435\
\:0441\:0441\:0430: \>\"", ",", "\"\<Text\>\"", ",", "Bold"}], "]"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
              "settime", "\[LeftDoubleBracket]", "i", 
               "\[RightDoubleBracket]"}]}], "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
               "target", "\[LeftDoubleBracket]", "i", 
                "\[RightDoubleBracket]"}], "\[NotEqual]", "0"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"Block", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"minv", ",", "maxv", ",", "tv"}], "}"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    "target", "\[LeftDoubleBracket]", "i", 
                    "\[RightDoubleBracket]"}], ">", "0"}], ",", 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"minv", "=", 
                    RowBox[{
                    "minout", "\[LeftDoubleBracket]", "i", 
                    "\[RightDoubleBracket]"}]}], ";", 
                    RowBox[{"maxv", "=", 
                    RowBox[{
                    "maxout", "\[LeftDoubleBracket]", "i", 
                    "\[RightDoubleBracket]"}]}], ";", 
                    RowBox[{"tv", "=", 
                    RowBox[{
                    "target", "\[LeftDoubleBracket]", "i", 
                    "\[RightDoubleBracket]"}]}]}], ",", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"minv", "=", 
                    RowBox[{"-", 
                    RowBox[{
                    "maxout", "\[LeftDoubleBracket]", "i", 
                    "\[RightDoubleBracket]"}]}]}], ";", 
                    RowBox[{"maxv", "=", 
                    RowBox[{"-", 
                    RowBox[{
                    "minout", "\[LeftDoubleBracket]", "i", 
                    "\[RightDoubleBracket]"}]}]}], ";", 
                    RowBox[{"tv", "=", 
                    RowBox[{"-", 
                    RowBox[{
                    "target", "\[LeftDoubleBracket]", "i", 
                    "\[RightDoubleBracket]"}]}]}]}]}], "]"}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"maxv", ">", "tv"}], ",", "\[IndentingNewLine]", 
                   RowBox[{"Print", "[", 
                    RowBox[{
                    RowBox[{"Spacer", "[", "40", "]"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{
                    "\"\<\:041f\:0435\:0440\:0435\:0440\:0435\:0433\:0443\
\:043b\:0438\:0440\:043e\:0432\:0430\:043d\:0438\:0435: \>\"", ",", 
                    "\"\<Text\>\"", ",", "Bold"}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"maxv", "/", "tv"}], "-", "1"}]}], "]"}]}], "]"}],
                  ";", "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"minv", "<", "0"}], ",", "\[IndentingNewLine]", 
                   RowBox[{"Print", "[", 
                    RowBox[{
                    RowBox[{"Spacer", "[", "40", "]"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{
                    "\"\<\:041f\:043e\:0434\:0440\:0435\:0433\:0443\:043b\
\:0438\:0440\:043e\:0432\:0430\:043d\:0438\:0435: \>\"", ",", "\"\<Text\>\"", 
                    ",", "Bold"}], "]"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"minv", "/", "tv"}]}], "]"}]}], "]"}]}]}], 
               "]"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "[", "output", "]"}]}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Transpose", "[", "sthistory", "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotLegends", "\[Rule]", "Automatic"}], ",", 
            RowBox[{"PlotRange", "\[Rule]", "Full"}]}], "]"}], "]"}]}]}], 
       "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"index", ",", 
        RowBox[{"signaldim", "[", "controlsignal", "]"}]}], "}"}]}], 
     "]"}]}]}], "]"}]], "Input",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGCQAmIQ3VU3xWf18deOcaYbwfQ/doZ8EL0hhBdMV7692gGi
Ww3uzQXRjLsij4Po9RzvwfS3vm83QHSandttEH1NYsN7MH9F5mcQ/Zg1WmgN
kL7UqCgJoifIxyqAaAeGDykgeu/Kf1kgus7jdSGIzvR1KQfRWQv9mkA0t/S9
NhDN8Th3Loje59C+HERfbytaBaJ3SZ/dAJZ3eHIHRLfxHn0EotXn7H0Mot9N
u6O5Fki7Vs41BtGprY0WIHqOr6UViC6R8LcD0WJhHG4guueqiQ+ILmuyjgfR
h7eGpYBondeXc0A026RnBSB67zT1SSDaw8h8FojeZ2W4HkQr+z7ZAaKXePuc
BNFKceeugegf+kp3QfR+OTWNU0BarY5DC0RfL1yVdQZIbzrAmQ2iXy179wpE
z8k1fQuiAa1o77U=
  "]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Noise filtering", "Subsection",
 CellChangeTimes->{{3.7286260534465275`*^9, 3.7286260560333276`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "residual", ",", "residualcovar", ",", "gain", ",", 
      "\[IndentingNewLine]", 
      RowBox[{"stateest", "=", "initstate"}], ",", "\[IndentingNewLine]", 
      RowBox[{"statecovar", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0", ",", 
         RowBox[{"Length", "[", "initstate", "]"}], ",", 
         RowBox[{"Length", "[", "initstate", "]"}]}], "]"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"noisecovar", "=", 
       RowBox[{"signalcovariance", "[", "noisesignal", "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"processcovar", "=", 
      RowBox[{"snmat", ".", "noisecovar", ".", 
       RowBox[{"Transpose", "[", "snmat", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"observcovar", "=", 
      RowBox[{"onmat", ".", "noisecovar", ".", 
       RowBox[{"Transpose", "[", "onmat", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"filthistory", "=", 
      RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"control", ",", "outputest", ",", "covargainmat"}], "}"}], 
         ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"control", "=", 
           RowBox[{"signalvalue", "[", 
            RowBox[{"controlsignal", ",", "time"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"outputest", "=", 
           RowBox[{
            RowBox[{"osmat", ".", "stateest"}], "+", 
            RowBox[{"oimat", ".", "control"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"stateest", "=", 
           RowBox[{
            RowBox[{"ssmat", ".", "stateest"}], "+", 
            RowBox[{"simat", ".", "control"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"statecovar", "=", 
           RowBox[{
            RowBox[{"ssmat", ".", "statecovar", ".", 
             RowBox[{"Transpose", "[", "ssmat", "]"}]}], "+", 
            "processcovar"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"residual", "=", 
           RowBox[{
            RowBox[{
             RowBox[{
             "history", "\[LeftDoubleBracket]", "time", 
              "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", 
             RowBox[{"1", ";;", "outputcount"}], "\[RightDoubleBracket]"}], 
            "-", 
            RowBox[{"osmat", ".", "stateest"}], "-", 
            RowBox[{"oimat", ".", "control"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"residualcovar", "=", 
           RowBox[{"observcovar", "+", 
            RowBox[{"osmat", ".", "statecovar", ".", 
             RowBox[{"Transpose", "[", "osmat", "]"}]}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"gain", "=", 
           RowBox[{"statecovar", ".", 
            RowBox[{"Transpose", "[", "osmat", "]"}], ".", 
            RowBox[{"PseudoInverse", "[", "residualcovar", "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"stateest", "=", 
           RowBox[{"stateest", "+", 
            RowBox[{"gain", ".", "residual"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"covargainmat", "=", 
           RowBox[{
            RowBox[{"IdentityMatrix", "[", 
             RowBox[{"Length", "[", "gain", "]"}], "]"}], "-", 
            RowBox[{"gain", ".", "osmat"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"statecovar", "=", 
           RowBox[{
            RowBox[{"covargainmat", ".", "statecovar", ".", 
             RowBox[{"Transpose", "[", "covargainmat", "]"}]}], "+", 
            "\[IndentingNewLine]", 
            RowBox[{"gain", ".", "observcovar", ".", 
             RowBox[{"Transpose", "[", "gain", "]"}]}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"filthistory", ",", 
            RowBox[{"Join", "[", 
             RowBox[{"outputest", ",", "stateest"}], "]"}]}], "]"}]}]}], 
        "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"time", ",", "1", ",", 
         RowBox[{"Length", "[", "history", "]"}]}], "}"}]}], "]"}]}]}], "]"}],
   ";"}]], "Input",
 CellChangeTimes->{{3.7286277709887495`*^9, 3.7286281169860506`*^9}, {
  3.72862814919637*^9, 3.7286286050500603`*^9}, {3.728628635876346*^9, 
  3.7286286652124443`*^9}, {3.7286287092731733`*^9, 3.7286287332984695`*^9}, {
  3.7286288056227193`*^9, 3.728629229422319*^9}, {3.7286294182527275`*^9, 
  3.728629473307608*^9}, {3.728629510571351*^9, 3.728629513085044*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Output filtering", "Subsection",
 CellChangeTimes->{{3.7286307363831787`*^9, 3.728630758971362*^9}}],

Cell[BoxData[
 RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Join", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"Transpose", "[", "history", "]"}], "\[LeftDoubleBracket]", 
      RowBox[{";;", "outputcount"}], "\[RightDoubleBracket]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Transpose", "[", "filthistory", "]"}], "\[LeftDoubleBracket]", 
      
      RowBox[{";;", "outputcount"}], "\[RightDoubleBracket]"}]}], "]"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
   RowBox[{"PlotLegends", "\[Rule]", "Automatic"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"PlotRange", "\[Rule]", "Full"}], ",", "\[IndentingNewLine]", 
   RowBox[{"ImageSize", "\[Rule]", "600"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.728630705908409*^9, 3.728630713802005*^9}, {
   3.7286307687987995`*^9, 3.7286307846661105`*^9}, 3.7286312274816484`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["State prediction versus actual state graph", "Subsection",
 CellChangeTimes->{{3.7286295465702376`*^9, 3.728629551263131*^9}, {
  3.728629594826129*^9, 3.7286296047196636`*^9}}],

Cell[BoxData[
 RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Join", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"Transpose", "[", "history", "]"}], "\[LeftDoubleBracket]", 
      RowBox[{
       RowBox[{"outputcount", "+", "1"}], ";;"}], "\[RightDoubleBracket]"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Transpose", "[", "filthistory", "]"}], "\[LeftDoubleBracket]", 
      
      RowBox[{
       RowBox[{"outputcount", "+", "1"}], ";;"}], "\[RightDoubleBracket]"}]}],
     "]"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
   RowBox[{"PlotLegends", "\[Rule]", "Automatic"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"PlotRange", "\[Rule]", "Full"}], ",", "\[IndentingNewLine]", 
   RowBox[{"ImageSize", "\[Rule]", "600"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.728629235565343*^9, 3.728629344996107*^9}, {
  3.728629379179324*^9, 3.7286293872261467`*^9}, {3.728630645098072*^9, 
  3.728630677863207*^9}, {3.728630720566944*^9, 3.7286307215163374`*^9}, {
  3.7286307917955837`*^9, 3.7286307935030932`*^9}, {3.728631234201518*^9, 
  3.7286312350828123`*^9}}]
}, Open  ]]
}, Open  ]]
},
WindowSize->{786, 733},
WindowMargins->{{Automatic, 146}, {Automatic, 3}},
PrintingCopies->1,
PrintingPageRange->{32000, 32000},
PrintingOptions->{"Magnification"->1.,
"PaperOrientation"->"Portrait",
"PaperSize"->{594.9599999999999, 842.04},
"PrintCellBrackets"->False,
"PrintMultipleHorizontalPages"->False,
"PrintRegistrationMarks"->False,
"PrintingMargins"->{{28.346456999999997`, 42.519685499999994`}, {72.00000078, \
72.00000078}}},
FrontEndVersion->"10.2 for Microsoft Windows (64-bit) (July 7, 2015)",
StyleDefinitions->Notebook[{
   Cell[
    StyleData[StyleDefinitions -> "Default.nb"]], 
   Cell[
    StyleData["Input"], FontFamily -> "Times New Roman", FontSize -> 13, 
    FontWeight -> "Plain", FontSlant -> "Plain", 
    FontVariations -> {"StrikeThrough" -> False, "Underline" -> False}]}, 
  WindowSize -> {775, 693}, WindowMargins -> {{0, Automatic}, {Automatic, 0}},
   Visible -> False, FrontEndVersion -> 
  "10.2 for Microsoft Windows (64-bit) (July 7, 2015)", StyleDefinitions -> 
  "PrivateStylesheetFormatting.nb"]
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 155, 2, 63, "Section"],
Cell[738, 26, 3369, 69, 192, "Input"],
Cell[4110, 97, 10123, 223, 1392, "Input"],
Cell[14236, 322, 2549, 58, 332, "Input"],
Cell[16788, 382, 1474, 32, 212, "Input"],
Cell[18265, 416, 3370, 76, 452, "Input"],
Cell[21638, 494, 7893, 176, 852, "Input"],
Cell[29534, 672, 6662, 163, 692, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[36233, 840, 95, 1, 63, "Section"],
Cell[CellGroupData[{
Cell[36353, 845, 152, 2, 43, "Subsection"],
Cell[36508, 849, 1915, 49, 292, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[38460, 903, 205, 3, 43, "Subsection"],
Cell[38668, 908, 2156, 53, 212, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[40861, 966, 121, 1, 43, "Subsection"],
Cell[40985, 969, 860, 14, 132, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[41882, 988, 110, 1, 43, "Subsection"],
Cell[41995, 991, 2381, 53, 292, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[44413, 1049, 122, 1, 43, "Subsection"],
Cell[44538, 1052, 12888, 294, 1032, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[57463, 1351, 107, 1, 43, "Subsection"],
Cell[57573, 1354, 4611, 103, 452, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[62221, 1462, 106, 1, 43, "Subsection"],
Cell[62330, 1465, 966, 20, 172, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[63333, 1490, 183, 2, 43, "Subsection"],
Cell[63519, 1494, 1197, 25, 172, "Input"]
}, Open  ]]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
